#!/usr/bin/env ruby

require 'optparse'
require 'srcgen/generator'

# Command line option processing
options = {}
# ...Specify defaults
options[:debug] = false
options[:noop] = false
# ...Specify the options
opts = OptionParser.new do |opts|
  opts.banner = "Usage: run_srcgen.rb [options] [config_file1 | ... | config_fileN]\n$Revision: $"
  opts.on("-d", "--debug", "Turns on debug mode") do |d|
    options[:debug] = d
  end
  opts.on("-x", "--noop", "Output the commands to be used, but do nothing") do |x|
    options[:noop] = x
  end
  opts.on_tail("-h", "--help", "Show this message") do
    puts opts
    exit(0)
  end
end
# ...Parse the options
begin
  opts.parse! ARGV
rescue OptionParser::ParseError => error_message
  puts("ERROR --> #{error_message}")
  puts(opts)
  exit(1)
end


# Command line argument processing
if ARGV.length == 0
  puts("\nNo SrcGen config files specified, nothing to do. Exiting...")
  exit(0)
end


# Process the config files
begin
  ARGV.each do |config_file|
    SrcGen::Generator.new.generate(config_file, debug=options[:debug])
  end
rescue Exception => error_message
  puts("\nERROR --> #{error_message}")
  exit(1)
end


puts("\nhello!!")  
