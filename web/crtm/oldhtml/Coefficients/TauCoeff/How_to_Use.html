<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>TauCoeff How to Use Page</title>
  <meta http-equiv="Content-Style-Type" content="text/css">
  <script type="text/javascript">
    <!-- Hide script from old browsers
    var BName = navigator.appName;
    if (BName != "Microsoft Internet Explorer")  {
      document.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cimss.ssec.wisc.edu/~paulv/StyleSheets/contents.css\">")
    }
    else {
      document.write("<link rel=\"stylesheet\" type=\"text/css\" href=\"http://cimss.ssec.wisc.edu/~paulv/StyleSheets/IEcontents.css\">")
    }
    ; // -->
  </script>
</head>
<body>
<h1 class="main"><a name="TOP"></a>TauCoeff How to Use</h1>

<hr width="100%">
This is just a simple step-by-step guide showing how I use the TauCoeff
modules in my own code to read and access the TauCoeff datafiles.



<!-- =========================================================== -->
<h2><a name="MODULE_USE_DEFINITIONS"></a>Module Use Definitions</h2>
<!-- =========================================================== -->

The first thing to do if you use any of my code is to include the modules that define the
various variable types (<code>Type_Kinds</code>) and the function return codes and a message display
routine (<code>Error_Handler</code>). In any of my code, this is always thefirst thing I do.

<pre>
  USE <a href="../../Utility/Modules.html#TYPE_KINDS">Type_Kinds</a>
  USE <a href="../../Utility/Modules.html#ERROR_HANDLER">Error_Handler</a>
</pre>

<p>Access to the TauCoeff derived types and their associated operations is
achieved by the following USE statements,

<pre>
  USE <a href="TauCoeff_Define.f90.html">TauCoeff_Define</a>
</pre>

<p>If you are going to read/write the netCDF format TauCoeff files, you'll
want to do,

<pre>
  USE <a href="TauCoeff_netCDF_IO.f90.html">TauCoeff_netCDF_IO</a>
</pre>

<p>For binary file access you'll want,

<pre>
  USE <a href="TauCoeff_Binary_IO.f90.html">TauCoeff_Binary_IO</a>
</pre>



<!-- ======================================================= -->
<h2><a name="VARIABLE_DEFINITIONS"></a>Variable Definitions</h2>
<!-- ======================================================= -->

The definitions I typically use when I want to read TauCoeff datafiles
are,

<pre>
  CHARACTER( * ), PARAMETER :: PROGRAM_NAME = 'My_Test_Program'

  INTEGER :: Error_Status
  CHARACTER( 256 )      :: TauCoeff_Filename
  TYPE( TauCoeff_type ) :: TauCoeff
</pre>



<!-- ============================================================== -->
<h2><a name="LOADING"></a>Loading data into the TauCoeff Structure</h2>
<!-- ============================================================== -->

Once you've defined the TauCoeff filename -- usually by requiring the user to input something into
the <code>TauCoeff_Filename</code> variable -- the TauCoeff structure is then filled simply by
calling read functions. For reading netCDF files,

<pre>
  ! -- Read the netCDF TauCoeff data file
  Error_Status = <a href="TauCoeff_netCDF_IO.f90.html#READ_TAUCOEFF_NETCDF">Read_TauCoeff_netCDF</a>( TauCoeff_Filename, &amp;
                                       TauCoeff )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error reading TauCoeff file '//TRIM( TauCoeff_Filename ), &amp;
                          FAILURE )
    STOP
  END IF
</pre>

The basic call to the binary file reader is effectively the same

<pre>
  ! -- Read the Binary TauCoeff data file
  Error_Status = <a href="TauCoeff_Binary_IO.f90.html#READ_TAUCOEFF_BINARY">Read_TauCoeff_Binary</a>( TauCoeff_Filename, &amp;
                                       TauCoeff )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error reading TauCoeff file '//TRIM( TauCoeff_Filename ), &amp;
                          FAILURE )
    STOP
  END IF
</pre>

<p>The differences between the netCDF and binary readers are in the
optional arguments, in particular the global attribute arguments in the
netCDF I/O functions.
 
<p>Once you've loaded the data into the TauCoeff structure, you can use
the components as you would any other variable, e.g.
 
<pre>
  WRITE( *, '( "The number of channels is ", i5 )' ) TauCoeff%n_Channels
</pre>

<p>If you're not familiar with Fortran90/95 structure syntax, the "<code>%</code>"
is the structure component selector character (akin to the "."
character in IDL and C).



<!-- ============================================================== -->
<h2><a name="CONCATENATION"></a>Concatentating TauCoeff Structures</h2>
<!-- ============================================================== -->

You can concatentate separate TauCoeff structures, either by channel or
absorber. This is necessary if you want to create an output file consisting
of data for more than one sensor and absorber - by default the TauCoeff files are
created for a single sensor and single absorber. The TauCoeff datafiles supplied
through this website are already concatenated by absorber, so only the channel
concatenation example is shown here. See the
<code><a href="TauCoeff_Define.f90.html#CONCATENATE_ABSORBER_TAUCOEFF">Concatenate_Absorber_TauCoeff</a></code>
function definition for more information about TauCoeff structure concatenation
along the absorber dimension.

<p>If you have two TauCoeff structures defined,

<pre>
  TYPE( TauCoeff_type ) :: TauCoeff1, TauCoeff2
</pre>

that have data for different sensors, they can be concatenated and then written to a separate
file like so,

<pre>
  ! -- Concatenate the structures
  Error_Status = <a href="TauCoeff_Define.f90.html#CONCATENATE_CHANNEL_TAUCOEFF">Concatenate_Channel_TauCoeff</a>( TauCoeff1, &amp;
                                               TauCoeff2 )

  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error concatenating TauCoeff structures', &amp;
                          FAILURE )
    STOP
  END IF

  ! -- Write the concatenated structure to a netCDF file
  Error_Status = <a href="TauCoeff_netCDF_IO.f90.html#WRITE_TAUCOEFF_NETCDF">Write_TauCoeff_netCDF</a>( 'Concatenated_TauCoeff.nc', &amp;
                                        TauCoeff1 )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error writing concatenated TauCoeff datafile', &amp;
                          FAILURE )
    STOP
  END IF
</pre>

Note that the second structure is concatenated onto the end of the
first one. If you want to preserve the first structure, you will have
to copy it to a separate structure and then perform the concatenation,
 
<pre>
  TYPE( TauCoeff_type ) :: TauCoeff1, TauCoeff2, TauCoeff_Tmp

  ! -- Read data into TauCoeff1 and TauCoeff2
  ....

  ! -- Copy the first structure into a temporary structure
  Error_Status = <a href="TauCoeff_Define.f90.html#ASSIGN_TAUCOEFF">Assign_TauCoeff</a>( TauCoeff1, &amp;
                                  TauCoeff_Tmp )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error copying TauCoeff1 structure', &amp;
                          FAILURE )
    STOP
  END IF

  ! -- Concatenate the structures
  Error_Status = <a href="TauCoeff_Define.f90.html#CONCATENATE_CHANNEL_TAUCOEFF">Concatenate_Channel_TauCoeff</a>( TauCoeff_Tmp, &amp;
                                               TauCoeff2 )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error concatenating TauCoeff structures', &amp;
                          FAILURE )
    STOP
  END IF

  ! -- Write the concatenated structure to a Binary file
  Error_Status = <a href="TauCoeff_Binary_IO.f90.html#WRITE_TAUCOEFF_BINARY">Write_TauCoeff_Binary</a>( 'Concatenated_TauCoeff.nc', &amp;
                                        TauCoeff_Tmp )
  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error writing concatenated TauCoeff datafile', &amp;
                          FAILURE )
    STOP
  END IF
</pre>



<!-- =============================================== -->
<h2><a name="DESTRUCTION"></a>Structure Destruction</h2>
<!-- =============================================== -->

The last step is to destroy the TauCoeff structure, freeing up all the allocated memory. This
step can be ignored if the the code is being used in a program (note I only issue a WARNING below
if the structure destruction does fail). But, if this code is used in a routine one should destroy the
structure before exiting the calling routine. Of course, the actual order depends on how your code is
organised, and I like to be explicit about deallocting pointers to avoid memory leaks. In the case
of the CRTM, the operations on the TauCoeff structures are hidden from the user, but it's still
important to know about.

<pre>
  ! -- Destroy the TauCoeff structure
  Error_Status = <a href="TauCoeff_Define.f90.html#DESTROY_TAUCOEFF">Destroy_TauCoeff</a>( TauCoeff )

  IF ( Error_Status /= <a href="../../../Utility/Modules.html#ERROR_HANDLER">SUCCESS</a> ) THEN
    CALL <a href="../../../Utility/Error_Handler.f90.html#DISPLAY_MESSAGE">Display_Message</a>( PROGRAM_NAME, &amp;
                          'Error destroying TauCoeff structure.', &amp;
                          WARNING )
  END IF
</pre>

 
<hr width="100%">
<address>This page maintained by <a href="mailto:paul.vandelst@ssec.wisc.edu?subject=TauCoeff%20How%20to%20Use">Paul van Delst</a></address>
<br>
Last updated $Date: 2005/05/10 17:38:19 $
<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br>
</body>
</html>
